
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Confessions of a Wall Street Programmer</title>
  <meta name="author" content="Bill Torpey">

  
  <meta name="description" content="Usage Parameters Environment Variables Notes Generated command format System Include Files Code Listing cc_driver.pl This script parses a &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://btorpey.github.io/pages/cc_driver.pl">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Confessions of a Wall Street Programmer" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-61420123-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


  
  <link href="/stylesheets/print.css" media="print" rel="stylesheet" type="text/css">  
</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Confessions of a Wall Street Programmer</a></h1>
  
    <h2>practical ideas (and perhaps some uncommon knowledge) on software architecture, design, construction and testing</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:btorpey.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article role="article">
  
  <ul id="markdown-toc">
  <li><a href="#usage">Usage</a></li>
  <li><a href="#parameters">Parameters</a></li>
  <li><a href="#environment-variables">Environment Variables</a></li>
  <li><a href="#notes">Notes</a>    <ul>
      <li><a href="#generated-command-format">Generated command format</a></li>
      <li><a href="#system-include-files">System Include Files</a></li>
    </ul>
  </li>
  <li><a href="#code-listing">Code Listing</a></li>
</ul>

<h1 class="no_toc" id="ccdriverpl">cc_driver.pl</h1>

<p>This script parses a <a href="http://clang.llvm.org/docs/JSONCompilationDatabase.html">compilation database</a>, and executes a specified command for each matching file in the database.  It generates a command that includes the <code>-I</code> and <code>-D</code> parameters used in the original compilation.</p>

<h2 id="usage">Usage</h2>

<p>cc_driver.pl [-d] [-v] [-s] [-n] [-p build_path]
[-i include_pattern] [-x exclude_pattern] command [parameters]</p>

<h2 id="parameters">Parameters</h2>

<table>
  <thead>
    <tr>
      <th>Parameter</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-d</td>
      <td>Debug – print generated command to stdout, but don’t execute it.  Implies -v (verbose).</td>
    </tr>
    <tr>
      <td>-v</td>
      <td>Be verbose.  Displays generated commands to stdout.</td>
    </tr>
    <tr>
      <td>-s</td>
      <td>Generate system include paths. See <a href="#system-includes">System Include Files</a>.</td>
    </tr>
    <tr>
      <td>-n</td>
      <td>Don’t include <code>-I</code> or <code>-D</code> parameters in the generated command. This can be useful when using the script to execute “normal” commands (e.g., grep) that don’t take such parameters.</td>
    </tr>
    <tr>
      <td>-p build_path</td>
      <td>Specifies the path to a compilation database in JSON format.  It can be either an absolute path to a compilation database, or a directory (which will be searched for a compile_commands.json file).  If omitted, the current directory is used.</td>
    </tr>
    <tr>
      <td>-i include_pattern</td>
      <td>File paths matching include_pattern are included in generated commands.  May be specified multiple times.  If omitted, all files in the compilation database are included.</td>
    </tr>
    <tr>
      <td>-x exclude_pattern</td>
      <td>File paths matching exclude_pattern are not included in generated commands.  May be specified multiple times.  All exclude_patterns are matched after any include patterns.</td>
    </tr>
    <tr>
      <td>command</td>
      <td>Specifies the command to run against each file.  (See <a href="#generated-command-format">below</a> for details on how the generated command line is constructed).</td>
    </tr>
    <tr>
      <td>parameters</td>
      <td>Any parameters for the specified command.  Note that you may need to quote the parameters if they include quotes themselves to avoid <a href="http://pubs.opengroup.org/onlinepubs/9699919799/utilities/V3_chap02.html#tag_18_06_07">quote removal</a>.</td>
    </tr>
  </tbody>
</table>

<h2 id="environment-variables">Environment Variables</h2>
<p>If the <code>-s</code> option is specified, the value of <code>${CXX}</code> is used as the name of the compiler.  (If <code>${CXX}</code> is not defined, the default is <code>g++</code>).</p>

<h2 id="notes">Notes</h2>
<p>The generated command first changes to the original build directory before executing the specified command, so specifying [command] using a relative path is generally a mistake.  Instead use an absolute path, or make sure that [command] can be found using the <code>PATH</code> environment variable.</p>

<h3 id="generated-command-format">Generated command format</h3>
<p>The script generates a command line of the form</p>

<p><code>
cd {directory}; [command] [parameters] -I .. -D .. {file}
</code></p>

<p>The clang tools require a slightly different format – if a clang tool is specified for [command], the generated command format is:</p>

<p><code>
cd {directory}; [command] {file} -- [parameters] -I .. -D .. 
</code></p>

<p><a id="system-includes"></a></p>

<h3 id="system-include-files">System Include Files</h3>
<p>Some of the tools that can be scripted with this command work better (sometimes much better) if they can see all the include files used in the original compilation. If the <code>-s</code> flag is specified, the system include paths are appended to any include paths from the original compile command.</p>

<p>The system include paths are:</p>

<ul>
  <li>
    <p>Any paths specified using the <code>-isystem</code> compiler flag.  (See <a href="https://gcc.gnu.org/onlinedocs/cpp/System-Headers.html">System Headers - The C Preprocessor</a> for why you might want to use the <code>isystem</code> flag).  As with the compiler’s <code>-isystem</code> flag, any directories specified are searched <em>after</em> all directories specified using the <code>-I</code> flag, regardless of where it occurs on the command line.</p>
  </li>
  <li>
    <p>The default compiler search paths are appended to the generated command line.  The compiler search paths are determined by parsing the output of
<code>${CXX} -E -x c++ - -v 2&gt;&amp;1 1&gt;/dev/null &lt;/dev/null</code></p>
  </li>
</ul>

<p>See <a href="/blog/2016/04/07/mo-static">this post</a> for more information.</p>

<h2 id="code-listing">Code Listing</h2>
<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span> (cc_driver.pl)</span> <a href="/downloads/code/static/scripts/cc_driver.pl">download</a></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
<span class="line-number">73</span>
<span class="line-number">74</span>
<span class="line-number">75</span>
<span class="line-number">76</span>
<span class="line-number">77</span>
<span class="line-number">78</span>
<span class="line-number">79</span>
<span class="line-number">80</span>
<span class="line-number">81</span>
<span class="line-number">82</span>
<span class="line-number">83</span>
<span class="line-number">84</span>
<span class="line-number">85</span>
<span class="line-number">86</span>
<span class="line-number">87</span>
<span class="line-number">88</span>
<span class="line-number">89</span>
<span class="line-number">90</span>
<span class="line-number">91</span>
<span class="line-number">92</span>
<span class="line-number">93</span>
<span class="line-number">94</span>
<span class="line-number">95</span>
<span class="line-number">96</span>
<span class="line-number">97</span>
<span class="line-number">98</span>
<span class="line-number">99</span>
<span class="line-number">100</span>
<span class="line-number">101</span>
<span class="line-number">102</span>
<span class="line-number">103</span>
<span class="line-number">104</span>
<span class="line-number">105</span>
<span class="line-number">106</span>
<span class="line-number">107</span>
<span class="line-number">108</span>
<span class="line-number">109</span>
<span class="line-number">110</span>
<span class="line-number">111</span>
<span class="line-number">112</span>
<span class="line-number">113</span>
<span class="line-number">114</span>
<span class="line-number">115</span>
<span class="line-number">116</span>
<span class="line-number">117</span>
<span class="line-number">118</span>
<span class="line-number">119</span>
<span class="line-number">120</span>
<span class="line-number">121</span>
<span class="line-number">122</span>
<span class="line-number">123</span>
<span class="line-number">124</span>
<span class="line-number">125</span>
<span class="line-number">126</span>
<span class="line-number">127</span>
<span class="line-number">128</span>
<span class="line-number">129</span>
<span class="line-number">130</span>
<span class="line-number">131</span>
<span class="line-number">132</span>
<span class="line-number">133</span>
<span class="line-number">134</span>
<span class="line-number">135</span>
<span class="line-number">136</span>
<span class="line-number">137</span>
<span class="line-number">138</span>
<span class="line-number">139</span>
<span class="line-number">140</span>
<span class="line-number">141</span>
<span class="line-number">142</span>
<span class="line-number">143</span>
<span class="line-number">144</span>
<span class="line-number">145</span>
<span class="line-number">146</span>
<span class="line-number">147</span>
<span class="line-number">148</span>
<span class="line-number">149</span>
<span class="line-number">150</span>
<span class="line-number">151</span>
<span class="line-number">152</span>
<span class="line-number">153</span>
<span class="line-number">154</span>
<span class="line-number">155</span>
<span class="line-number">156</span>
<span class="line-number">157</span>
<span class="line-number">158</span>
<span class="line-number">159</span>
<span class="line-number">160</span>
<span class="line-number">161</span>
<span class="line-number">162</span>
<span class="line-number">163</span>
<span class="line-number">164</span>
<span class="line-number">165</span>
<span class="line-number">166</span>
<span class="line-number">167</span>
<span class="line-number">168</span>
<span class="line-number">169</span>
<span class="line-number">170</span>
<span class="line-number">171</span>
<span class="line-number">172</span>
<span class="line-number">173</span>
<span class="line-number">174</span>
<span class="line-number">175</span>
<span class="line-number">176</span>
<span class="line-number">177</span>
<span class="line-number">178</span>
<span class="line-number">179</span>
<span class="line-number">180</span>
<span class="line-number">181</span>
<span class="line-number">182</span>
<span class="line-number">183</span>
<span class="line-number">184</span>
<span class="line-number">185</span>
<span class="line-number">186</span>
<span class="line-number">187</span>
<span class="line-number">188</span>
<span class="line-number">189</span>
<span class="line-number">190</span>
<span class="line-number">191</span>
<span class="line-number">192</span>
<span class="line-number">193</span>
<span class="line-number">194</span>
<span class="line-number">195</span>
<span class="line-number">196</span>
<span class="line-number">197</span>
<span class="line-number">198</span>
<span class="line-number">199</span>
<span class="line-number">200</span>
<span class="line-number">201</span>
<span class="line-number">202</span>
<span class="line-number">203</span>
</pre></td><td class="code"><pre><code class="perl"><span class="line"><span class="c1">#!/usr/bin/perl</span>
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="c1"># Copyright 2016 by Bill Torpey. All Rights Reserved.</span>
</span><span class="line"><span class="c1"># This work is licensed under a Creative Commons Attribution-NonCommercial-NoDerivs 3.0 United States License.</span>
</span><span class="line"><span class="c1"># http://creativecommons.org/licenses/by-nc-nd/3.0/us/deed.en</span>
</span><span class="line"><span class="c1">#</span>
</span><span class="line"><span class="k">use</span> <span class="n">strict</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="c1">###############################################################</span>
</span><span class="line"><span class="c1"># get compiler&#39;s default include path</span>
</span><span class="line"><span class="k">sub </span><span class="nf">getCXXIncludes</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">   <span class="c1"># get compiler command</span>
</span><span class="line">   <span class="k">my</span> <span class="nv">$compiler</span> <span class="o">=</span> <span class="nv">$ENV</span><span class="p">{</span><span class="s">&#39;CXX&#39;</span><span class="p">};</span>
</span><span class="line">   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">defined</span> <span class="nv">$compiler</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="nv">$compiler</span> <span class="o">=</span> <span class="s">&quot;g++&quot;</span><span class="p">;</span>
</span><span class="line">   <span class="p">}</span>
</span><span class="line">
</span><span class="line">   <span class="k">my</span> <span class="nv">@includes</span><span class="p">;</span>
</span><span class="line">   <span class="k">my</span> <span class="nv">$capture</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line">   <span class="k">my</span> <span class="nv">@lines</span> <span class="o">=</span> <span class="sb">`$compiler  -E -x c++ - -v 2&gt;&amp;1 1&gt;/dev/null &lt;/dev/null`</span><span class="p">;</span>
</span><span class="line">   <span class="k">for</span> <span class="k">my</span> <span class="nv">$line</span> <span class="p">(</span><span class="nv">@lines</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="k">if</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /#include &lt;...&gt; search starts here:/</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">         <span class="nv">$capture</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">      <span class="k">elsif</span> <span class="p">(</span><span class="nv">$line</span> <span class="o">=~</span><span class="sr"> /End of search list./</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">         <span class="k">return</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nv">@includes</span><span class="p">);</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">      <span class="k">else</span> <span class="p">{</span>
</span><span class="line">         <span class="k">if</span> <span class="p">(</span><span class="nv">$capture</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="nv">$line</span> <span class="o">=~</span> <span class="sr">s/\(framework directory\)//</span><span class="p">;</span>       <span class="c1"># xcode silliness</span>
</span><span class="line">            <span class="k">my</span> <span class="nv">$include</span> <span class="o">=</span> <span class="s">&quot;-I&quot;</span> <span class="o">.</span> <span class="n">trim</span><span class="p">(</span><span class="nv">$line</span><span class="p">);</span>
</span><span class="line">            <span class="nb">push</span> <span class="nv">@includes</span><span class="p">,</span> <span class="nv">$include</span><span class="p">;</span>
</span><span class="line">         <span class="p">}</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">   <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">###############################################################</span>
</span><span class="line"><span class="c1"># trims commas, quotes, leading &amp; trailing spaces from a string</span>
</span><span class="line"><span class="k">sub </span><span class="nf">trim</span>
</span><span class="line"><span class="p">{</span>
</span><span class="line">   <span class="k">my</span> <span class="nv">@out</span> <span class="o">=</span> <span class="nv">@_</span><span class="p">;</span>
</span><span class="line">   <span class="k">for</span> <span class="p">(</span><span class="nv">@out</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="sr">s/^\s+//</span><span class="p">;</span>
</span><span class="line">      <span class="sr">s/\s+$//</span><span class="p">;</span>
</span><span class="line">      <span class="sr">s/&quot;//g</span><span class="p">;</span>
</span><span class="line">      <span class="sr">s/,//g</span><span class="p">;</span>
</span><span class="line">   <span class="p">}</span>
</span><span class="line">   <span class="k">return</span> <span class="nb">wantarray</span> <span class="p">?</span> <span class="nv">@out</span> <span class="p">:</span> <span class="nv">$out</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="c1">###############################################################</span>
</span><span class="line"><span class="c1"># get cmd line args</span>
</span><span class="line"><span class="k">use</span> <span class="nn">Getopt::</span><span class="n">Long</span> <span class="sx">qw(:config pass_through bundling)</span><span class="p">;</span>
</span><span class="line"><span class="c1"># location and/or name of compile db</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$build_path</span> <span class="o">=</span> <span class="s">&quot;compile_commands.json&quot;</span><span class="p">;</span>
</span><span class="line"><span class="n">GetOptions</span><span class="p">(</span><span class="s">&#39;p=s&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$build_path</span><span class="p">);</span>
</span><span class="line"><span class="c1"># debug mode</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$debug</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="n">GetOptions</span><span class="p">(</span><span class="s">&#39;d&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$debug</span><span class="p">);</span>
</span><span class="line"><span class="c1"># whether to generate command a la compiler</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$no_params</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="n">GetOptions</span><span class="p">(</span><span class="s">&#39;n&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$no_params</span><span class="p">);</span>
</span><span class="line"><span class="c1"># whether to include system headers</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$include_sys_headers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="n">GetOptions</span><span class="p">(</span><span class="s">&#39;s&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$include_sys_headers</span><span class="p">);</span>
</span><span class="line"><span class="c1"># verbose?</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$verbose</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class="line"><span class="n">GetOptions</span><span class="p">(</span><span class="s">&#39;v&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">$verbose</span><span class="p">);</span>
</span><span class="line"><span class="c1"># match file path/name?</span>
</span><span class="line"><span class="k">my</span> <span class="nv">@match</span><span class="p">;</span>
</span><span class="line"><span class="n">GetOptions</span><span class="p">(</span><span class="s">&#39;i=s&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@match</span><span class="p">);</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$match</span><span class="p">;</span>
</span><span class="line"><span class="k">if</span> <span class="p">((</span><span class="nb">scalar</span> <span class="nv">@match</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">   <span class="nv">$match</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="p">,</span> <span class="nv">@match</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">my</span> <span class="nv">@exclude</span><span class="p">;</span>
</span><span class="line"><span class="n">GetOptions</span><span class="p">(</span><span class="s">&#39;x=s&#39;</span> <span class="o">=&gt;</span> <span class="o">\</span><span class="nv">@exclude</span><span class="p">);</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$exclude</span><span class="p">;</span>
</span><span class="line"><span class="k">if</span> <span class="p">((</span><span class="nb">scalar</span> <span class="nv">@exclude</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">   <span class="nv">$exclude</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot;|&quot;</span><span class="p">,</span> <span class="nv">@exclude</span><span class="p">);</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="c1"># debug implies verbose</span>
</span><span class="line"><span class="p">(</span><span class="nv">$debug</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$verbose</span> <span class="o">=</span> <span class="mi">1</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="p">(</span><span class="nv">$verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">print</span> <span class="s">&quot;parameters=@ARGV\n&quot;</span><span class="p">;</span>
</span><span class="line">
</span><span class="line">
</span><span class="line"><span class="c1">###############################################################</span>
</span><span class="line"><span class="c1"># main</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$compile_commands</span><span class="p">;</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">f</span> <span class="nv">$build_path</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">   <span class="nv">$compile_commands</span> <span class="o">=</span> <span class="nv">$build_path</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">elsif</span><span class="p">(</span><span class="o">-</span><span class="n">d</span> <span class="nv">$build_path</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">    <span class="nv">$compile_commands</span> <span class="o">=</span> <span class="nv">$build_path</span> <span class="o">.</span> <span class="s">&quot;/compile_commands.json&quot;</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">else</span> <span class="p">{</span>
</span><span class="line">   <span class="nb">die</span> <span class="s">&quot;$build_path doesn&#39;t exist!&quot;</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="o">-</span><span class="n">e</span> <span class="nv">$build_path</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line"><span class="k">else</span> <span class="p">{</span>
</span><span class="line">   <span class="nb">die</span> <span class="s">&quot;$build_path doesn&#39;t exist!&quot;</span><span class="p">;</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">my</span> <span class="nv">$compiler_includes</span><span class="p">;</span>
</span><span class="line"><span class="k">if</span> <span class="p">(</span><span class="nv">$include_sys_headers</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">   <span class="nv">$compiler_includes</span> <span class="o">=</span> <span class="n">getCXXIncludes</span><span class="p">();</span>
</span><span class="line">   <span class="k">if</span> <span class="p">(</span><span class="nv">$verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="k">print</span> <span class="s">&quot;system includes = $compiler_includes\n&quot;</span><span class="p">;</span>
</span><span class="line">   <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="nb">open</span><span class="p">(</span><span class="n">INFILE</span><span class="p">,</span> <span class="s">&quot;&lt;:crlf&quot;</span><span class="p">,</span> <span class="s">&quot;$compile_commands&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">die</span> <span class="s">&quot;Cant open $compile_commands\n&quot;</span><span class="p">;</span>
</span><span class="line">
</span><span class="line"><span class="k">my</span> <span class="nv">@params</span><span class="p">;</span>
</span><span class="line"><span class="k">my</span> <span class="nv">@system_includes</span><span class="p">;</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$directory</span><span class="p">;</span>
</span><span class="line"><span class="k">my</span> <span class="nv">$file</span><span class="p">;</span>
</span><span class="line"><span class="k">while</span> <span class="p">(</span><span class="sr">&lt;INFILE&gt;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">   <span class="k">my</span> <span class="nv">@tokens</span> <span class="o">=</span> <span class="nb">split</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nv">$_</span><span class="p">);</span>
</span><span class="line">   <span class="k">if</span> <span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&#39;{&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="c1"># start of an entry</span>
</span><span class="line">      <span class="nv">@params</span>  <span class="o">=</span> <span class="p">();</span>
</span><span class="line">      <span class="nv">@system_includes</span>  <span class="o">=</span> <span class="p">();</span>
</span><span class="line">      <span class="nv">$directory</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span class="line">      <span class="nv">$file</span>      <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span class="line">   <span class="p">}</span>
</span><span class="line">   <span class="k">elsif</span> <span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&#39;&quot;command&quot;:&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="k">if</span> <span class="p">(</span><span class="nv">$no_params</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">         <span class="k">for</span> <span class="k">my</span> <span class="nv">$i</span> <span class="p">(</span><span class="mi">1</span> <span class="o">..</span> <span class="nv">$#tokens</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&quot;-D&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">               <span class="nb">push</span> <span class="nv">@params</span><span class="p">,</span> <span class="s">&quot;-D&quot;</span> <span class="o">.</span> <span class="nv">$tokens</span><span class="p">[</span><span class="o">++</span><span class="nv">$i</span><span class="p">];</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">            <span class="k">elsif</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;-D&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">               <span class="nb">push</span> <span class="nv">@params</span><span class="p">,</span> <span class="nv">$tokens</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">            <span class="k">elsif</span> <span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&quot;-I&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">               <span class="nb">push</span> <span class="nv">@params</span><span class="p">,</span> <span class="s">&quot;-I&quot;</span> <span class="o">.</span> <span class="nv">$tokens</span><span class="p">[</span><span class="o">++</span><span class="nv">$i</span><span class="p">];</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">            <span class="k">elsif</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;-I&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">               <span class="nb">push</span> <span class="nv">@params</span><span class="p">,</span> <span class="nv">$tokens</span><span class="p">[</span><span class="nv">$i</span><span class="p">];</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">            <span class="k">elsif</span> <span class="p">(</span><span class="nb">substr</span><span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="nv">$i</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">8</span><span class="p">)</span> <span class="ow">eq</span> <span class="s">&quot;-isystem&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">               <span class="k">if</span> <span class="p">(</span><span class="nv">$include_sys_headers</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">                  <span class="nb">push</span> <span class="nv">@system_includes</span><span class="p">,</span> <span class="s">&quot;-I&quot;</span> <span class="o">.</span> <span class="nv">$tokens</span><span class="p">[</span><span class="o">++</span><span class="nv">$i</span><span class="p">];</span>
</span><span class="line">               <span class="p">}</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">            <span class="k">elsif</span> <span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&quot;-fstack-usage&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">               <span class="c1"># skip it -- not material to analysis, and clang errors out</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">            <span class="k">elsif</span> <span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="nv">$i</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&quot;-frecord-gcc-switches&quot;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">               <span class="c1"># skip it -- not material to analysis, and clang errors out</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">         <span class="p">}</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">   <span class="p">}</span>
</span><span class="line">   <span class="k">elsif</span> <span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&#39;&quot;directory&quot;:&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="nv">$directory</span> <span class="o">=</span> <span class="n">trim</span><span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class="line">   <span class="p">}</span>
</span><span class="line">   <span class="k">elsif</span> <span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&#39;&quot;file&quot;:&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="nv">$file</span> <span class="o">=</span> <span class="n">trim</span><span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span><span class="line">   <span class="p">}</span>
</span><span class="line">   <span class="k">elsif</span> <span class="p">(</span><span class="nv">$tokens</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">eq</span> <span class="s">&#39;},&#39;</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">      <span class="c1"># end of an entry</span>
</span><span class="line">      <span class="k">my</span> <span class="nv">$params</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nv">@params</span><span class="p">);</span>
</span><span class="line">      <span class="k">my</span> <span class="nv">$system_includes</span> <span class="o">=</span> <span class="nb">join</span><span class="p">(</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="nv">@system_includes</span><span class="p">);</span>
</span><span class="line">      <span class="k">my</span> <span class="nv">$cmd</span><span class="p">;</span>
</span><span class="line">      <span class="k">if</span> <span class="p">(</span><span class="nv">$ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=~</span><span class="sr"> /clang/</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">         <span class="c1"># clang tools use a specific command line format</span>
</span><span class="line">         <span class="nv">$cmd</span> <span class="o">=</span> <span class="s">&quot;cd $directory;@ARGV $file -- $params $system_includes $compiler_includes&quot;</span><span class="p">;</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">      <span class="k">else</span> <span class="p">{</span>
</span><span class="line">         <span class="c1"># else assume that command format is same as normal compiler command</span>
</span><span class="line">         <span class="nv">$cmd</span> <span class="o">=</span> <span class="s">&quot;cd $directory;@ARGV $params $system_includes $compiler_includes $file&quot;</span><span class="p">;</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">      <span class="c1"># include/exclude file based on -i/-x param</span>
</span><span class="line">      <span class="k">my</span> <span class="nv">$run</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class="line">      <span class="p">((</span><span class="nb">defined</span> <span class="nv">$match</span><span class="p">)</span>   <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">!~</span> <span class="sr">/$match/</span><span class="p">))</span>   <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$run</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line">      <span class="p">((</span><span class="nb">defined</span> <span class="nv">$exclude</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$file</span> <span class="o">=~</span><span class="sr"> /$exclude/</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nv">$run</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
</span><span class="line">      <span class="k">if</span> <span class="p">(</span><span class="nv">$run</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">         <span class="k">my</span> <span class="nv">$output</span><span class="p">;</span>
</span><span class="line">         <span class="p">(</span><span class="nv">$verbose</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="k">print</span> <span class="s">&quot;$cmd\n&quot;</span><span class="p">;</span>
</span><span class="line">         <span class="k">if</span> <span class="p">(</span><span class="nv">$debug</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">            <span class="nv">$output</span> <span class="o">=</span> <span class="sb">`$cmd 2&gt;&amp;1`</span><span class="p">;</span>
</span><span class="line">            <span class="k">my</span> <span class="nv">$rc</span> <span class="o">=</span> <span class="vg">$?</span><span class="p">;</span>
</span><span class="line">            <span class="k">if</span> <span class="p">(</span><span class="nv">$rc</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class="line">               <span class="nb">die</span> <span class="s">&quot;$cmd returned $rc!&quot;</span><span class="p">;</span>
</span><span class="line">            <span class="p">}</span>
</span><span class="line">            <span class="k">print</span> <span class="s">&quot;$output\n&quot;</span><span class="p">;</span>
</span><span class="line">         <span class="p">}</span>
</span><span class="line">      <span class="p">}</span>
</span><span class="line">      <span class="c1"># exit on signal</span>
</span><span class="line">      <span class="p">(</span><span class="vg">$?</span> <span class="o">&amp;</span> <span class="mi">127</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nb">exit</span><span class="p">;</span>
</span><span class="line">   <span class="p">}</span>
</span><span class="line"><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="nb">close</span><span class="p">(</span><span class="n">INFILE</span><span class="p">);</span>
</span><span class="line">
</span><span class="line"><span class="mi">0</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

  
    <footer>
      
      
        <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://btorpey.github.io/pages/cc_driver.pl/index.html" data-via="wallstprog" data-counturl="http://btorpey.github.io/pages/cc_driver.pl/index.html" >Tweet</a>
  
  
  
</div>

      
    </footer>
  
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2016/11/12/even-mo-static/">Even Mo' Static</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/10/13/custom-tailor/">Custom-Tailored Configuration</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/04/07/mo-static/">Mo' Static</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/10/13/remote-scripting-with-bash-and-ssh/">Remote Scripting with bash and ssh</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/27/static-analysis-with-clang/">Static Analysis with clang</a>
      </li>
    
  </ul>
</section>
<section>
  
  <a href="/about/index.html"><h1>About...</h1></a>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
Copyright &copy; 2016 - Bill Torpey. &nbsp; All Rights Reserved.
<br>
<a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /></a> This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/deed.en_US">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>.
<br>
<span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'wallstprog';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://btorpey.github.io/pages/cc_driver.pl/index.html';
        var disqus_url = 'http://btorpey.github.io/pages/cc_driver.pl/index.html';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
